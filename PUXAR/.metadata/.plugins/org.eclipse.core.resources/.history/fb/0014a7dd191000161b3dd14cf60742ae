//global
var productlist=new Array();
var total=0;

$(document).ready(function(){
	//make ajax call to get item list
	$('#map_Content').hide();
	makecall();
})

function makecall(product,flag){
	
	product='{"product": "'+product+'"}';
	product=jQuery.parseJSON(product);
	
	$.ajax({
		
	    url: '/home',
	    data: product,
        type: 'POST',
        jsonpCallback: 'callback',
        timeout:2000,
        success: function (data) {
        	if(flag)
        	showproduct(data);
        	else        	
        	  loadlist(data);
        },
        error: function (xhr, status, error) {
            console.log('Error: ' + error.message);	        
        },
});
}

function loadlist(data){
	jQuery.each(data, function(i,val){
		productlist.push(data[i].PNAME);
	});
	
	$('#searchtext').autocomplete({
		source: productlist
	});
}

function searchitem(){	
	var product=$("#searchtext").val().toLowerCase();

	makecall(product,true);
}

function showproduct(data){
	//alert(data[0].PNAME);
	$('#search').hide();
	$('#product_img').attr('src',data[0].PIMG);
	$('#product_name').html(data[0].PNAME);
	$('#product_desc').html("<ul>"+data[0].PDESC+"</ul>");
	$('#product_price').html("$"+data[0].PRICE);
	$('#product_buttons').html('<div class="col-lg-6" id="content"> <button type="button" class="btn" id="locate">LOCATE</button></div> <div class="col-lg-6" id="content"><button type="button" class="btn" id="add" onclick="buy_product(\''+data[0].PNAME+'\','+data[0].PRICE+');">ADD TO CART</button></div>');
}

function buy_product(name,price){
	total+=price;
	name=name.split(" ");
	name=name[0]+" "+name[name.size];
	$('.card-content').append('<div class="col-lg-6" id="content"><label class="checkout">'+name+' :</label></div><div class="col-lg-6" id="content"><label class="checkout">'+price+'</label><br></div>');
	$('#checkout_total').html(total+".00");
	
}